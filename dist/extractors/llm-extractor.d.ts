/**
 * LLM Extractor for EDM v0.4.0
 * Uses Anthropic Claude to extract emotional data from content
 * Based on proven extraction logic from system-prompt-B.ts, reconciled with canonical schema
 */
import Anthropic from "@anthropic-ai/sdk";
import type { LlmExtractedFields, ExtractionInput } from "../schema/types.js";
/**
 * System prompt for EDM extraction - Updated for v0.4.0 canonical schema
 * Reconciled field names from system-prompt-B.ts:
 * - archetype_energy → narrative_archetype
 * - meaning_inference → expressed_insight
 * - transcendent_moment → transformational_pivot
 * - REMOVED: active_motivational_state, media_context, memory_layers, tether_target, moral_valence
 * - reentry_score → recurrence_pattern (type changed: number → enum)
 * - ADDED: somatic_signature
 */
export declare const EXTRACTION_SYSTEM_PROMPT = "\nYou classify emotionally rich memories into a JSON object. Input may include text and an image.\n\nRules\n- Fuse text + image. Treat text as primary; use image only to add grounded specifics (place, event, symbols, people).\n- Keep fields to single words or short phrases (1\u20133 words). Only \"narrative\" is multi-sentence (3\u20135).\n- No invention. If not supported by input, use null.\n- Always include every top-level key and sub-key from the schema, even if the value is null or an empty array.\n- Do not omit fields; if unknown, return null.\n- Output JSON only \u2014 no commentary, markdown, or extra text.\n- If motivation is ambiguous, choose the most conservative option (e.g., \"curiosity\" vs \"fear\") or return null.\n\nCRITICAL: Enum Field Constraints\n- Many fields below are STRICT ENUMS with a fixed set of allowed values.\n- You MUST use ONLY the values listed in the enum sets. Do not invent similar values.\n- Cross-contamination warning: Each enum field has its own distinct value set. Do not use values from one field in another.\n  Example: \"milestone\" is valid for memory_type but NOT for narrative_arc.\n  Example: \"confront\" is valid for both drive_state and coping_style - check which field you're populating.\n- If none of the allowed enum values adequately capture the expressed content, use the closest match. Do not invent alternatives.\n\nNormalization (very important)\n- Emit lowercase for all string fields except proper names in arrays like associated_people.\n- For array fields (emotion_subtone, recall_triggers, retrieval_keys, nearby_themes, resilience_markers, associated_people):\n  \u2022 use short tokens/phrases without punctuation;\n  \u2022 avoid duplicates;\n  \u2022 prefer singular nouns where reasonable (\"tradition\" not \"traditions\").\n- Never put boolean-like strings (\"true\"/\"false\") into fields that are boolean; use real booleans.\n\nSchema\n{\n  \"core\": {\n    \"anchor\": \"\",            // central theme (e.g., \"dad's toolbox\", \"nana's traditions\")\n    \"spark\": \"\",             // what triggered the memory (e.g., \"finding the cassette\", \"first snow\")\n    \"wound\": \"\",             // emotional pain present (e.g., \"loss\", \"regret\", \"distance\")\n    \"fuel\": \"\",              // what energized the experience (e.g., \"shared laughter\", \"curiosity\")\n    \"bridge\": \"\",            // connection between past and present (e.g., \"replaying old tape\", \"returning to the porch\")\n    \"echo\": \"\",              // what still resonates (e.g., \"her laugh\", \"smell of oil\", \"city lights on water\")\n    \"narrative\": \"\"          // 3\u20135 sentences; include \u22651 sensory detail, \u22651 temporal cue, and a symbolic callback; faithful and concise\n  },\n  \"constellation\": {\n    \"emotion_primary\": \"\",           // STRICT ENUM: joy | sadness | fear | anger | wonder | peace | tenderness | reverence | pride | anxiety | gratitude | longing (pick best-fit from these 12 ONLY)\n    \"emotion_subtone\": [],           // 2\u20134 short words (e.g., bittersweet, grateful) \u2014 free text array\n    \"higher_order_emotion\": \"\",      // free text: e.g., awe, forgiveness, pride, moral_elevation (or null)\n    \"meta_emotional_state\": \"\",      // free text: e.g., acceptance, confusion, curiosity (or null)\n    \"interpersonal_affect\": \"\",      // free text: e.g., warmth, openness, defensiveness (or null)\n    \"narrative_arc\": \"\",             // STRICT ENUM: overcoming | transformation | connection | reflection | closure (pick ONE or null)\n    \"relational_dynamics\": \"\",       // STRICT ENUM: parent_child | romantic_partnership | sibling_bond | friendship | companionship | mentorship | reunion | community_ritual | grief | self_reflection | professional | therapeutic | service | adversarial (pick ONE)\n    \"temporal_context\": \"\",          // STRICT ENUM: childhood | early_adulthood | midlife | late_life | recent | future | timeless (pick ONE or null)\n    \"memory_type\": \"\",               // STRICT ENUM: legacy_artifact | fleeting_moment | milestone | reflection | formative_experience (pick ONE or null)\n    \"media_format\": \"\",              // photo, video, audio, text, photo_with_story (or null)\n    \"narrative_archetype\": \"\",       // STRICT ENUM: hero | caregiver | seeker | sage | lover | outlaw | innocent | magician | creator | everyman | jester | ruler | mentor (pick ONE or null; lowercase)\n    \"symbolic_anchor\": \"\",           // concrete object/place/ritual (or null)\n    \"relational_perspective\": \"\",    // STRICT ENUM: self | partner | family | friends | community | humanity (pick ONE or null)\n    \"temporal_rhythm\": \"\",           // STRICT ENUM: still | sudden | rising | fading | recurring | spiraling | dragging | suspended | looping | cyclic (pick ONE or null)\n    \"identity_thread\": \"\",           // short sentence\n    \"expressed_insight\": \"\",         // brief insight explicitly stated by subject (extracted, not inferred)\n    \"transformational_pivot\": false, // true if subject explicitly identifies this as life-changing\n    \"somatic_signature\": \"\"          // bodily sensations explicitly described (e.g., \"chest tightness\", \"warmth spreading\") or null\n  },\n  \"milky_way\": {\n    \"event_type\": \"\",                // e.g., family gathering, farewell, birthday (or null)\n    \"location_context\": \"\",          // place from text or image (or null)\n    \"associated_people\": [],         // names or roles (proper case allowed)\n    \"visibility_context\": \"\",        // STRICT ENUM: private | family_only | shared_publicly (pick ONE or null)\n    \"tone_shift\": \"\"                 // e.g., loss to gratitude (or null)\n  },\n  \"gravity\": {\n    \"emotional_weight\": 0.0,         // 0.0\u20131.0 (felt intensity)\n    \"emotional_density\": \"\",         // STRICT ENUM: low | medium | high (pick ONE or null)\n    \"valence\": \"\",                   // STRICT ENUM: positive | negative | mixed (pick ONE or null)\n    \"viscosity\": \"\",                 // STRICT ENUM: low | medium | high | enduring | fluid (pick ONE or null)\n    \"gravity_type\": \"\",              // short phrase (e.g., symbolic resonance)\n    \"tether_type\": \"\",               // STRICT ENUM: person | symbol | event | place | ritual | object | tradition (pick ONE or null)\n    \"recall_triggers\": [],           // sensory or symbolic cues (lowercase tokens)\n    \"retrieval_keys\": [],            // compact hooks (3\u20136 tokens recommended)\n    \"nearby_themes\": [],             // adjacent concepts\n    \"legacy_embed\": false,\n    \"recurrence_pattern\": \"\",        // STRICT ENUM: cyclical | isolated | chronic | emerging (pick ONE or null)\n    \"strength_score\": 0.0,           // 0.0\u20131.0 (binding strength)\n    \"temporal_decay\": \"\",            // STRICT ENUM: fast | moderate | slow (pick ONE or null)\n    \"resilience_markers\": [],        // 1\u20133 (e.g., acceptance, optimism, continuity)\n    \"adaptation_trajectory\": \"\"      // STRICT ENUM: improving | stable | declining | integrative (pick ONE or null)\n  },\n  \"impulse\": {\n    \"primary_energy\": \"\",              // free text: e.g., curiosity, fear, compassion (or null; lowercase)\n    \"drive_state\": \"\",                 // STRICT ENUM: explore | approach | avoid | repair | persevere | share | confront | protect | process (pick ONE or null)\n    \"motivational_orientation\": \"\",    // STRICT ENUM: belonging | safety | mastery | meaning | autonomy (pick ONE or null)\n    \"temporal_focus\": \"\",              // STRICT ENUM: past | present | future (pick ONE or null)\n    \"directionality\": \"\",              // STRICT ENUM: inward | outward | transcendent (pick ONE or null)\n    \"social_visibility\": \"\",           // STRICT ENUM: private | relational | collective (pick ONE or null)\n    \"urgency\": \"\",                     // STRICT ENUM: calm | elevated | pressing | acute (pick ONE or null)\n    \"risk_posture\": \"\",                // STRICT ENUM: cautious | balanced | bold (pick ONE or null)\n    \"agency_level\": \"\",                // STRICT ENUM: low | medium | high (pick ONE or null)\n    \"regulation_state\": \"\",            // STRICT ENUM: regulated | wavering | dysregulated (pick ONE or null)\n    \"attachment_style\": \"\",            // STRICT ENUM: secure | anxious | avoidant | disorganized (pick ONE or null)\n    \"coping_style\": \"\"                 // STRICT ENUM: reframe_meaning | seek_support | distract | ritualize | confront | detach (pick ONE or null)\n  }\n\n  // Calibration \u2014 Impulse (helps apply the fields consistently)\n  // - temporal_focus: past (reminisce), present (here-and-now coping), future (plans/longing).\n  // - directionality: inward (self-processing), outward (toward others), transcendent (beyond self).\n  // - social_visibility: private (to self or 1:1), relational (friends/family), collective (community-wide).\n  // - If uncertain, choose the most conservative option or null.\n}\n";
export interface LlmExtractionResult {
    extracted: LlmExtractedFields;
    confidence: number;
    model: string;
    notes: string | null;
}
/**
 * Extract EDM fields from content using Anthropic Claude
 */
export declare function extractWithLlm(client: Anthropic, input: ExtractionInput, model?: string): Promise<LlmExtractionResult>;
/**
 * Calculate extraction confidence based on field population
 */
export declare function calculateConfidence(extracted: LlmExtractedFields): number;
/**
 * Create an Anthropic client
 */
export declare function createAnthropicClient(apiKey?: string): Anthropic;
//# sourceMappingURL=llm-extractor.d.ts.map